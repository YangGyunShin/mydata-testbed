<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default-layout}">
<head>
    <title>íšŒì›ê°€ì… - ì´ë©”ì¼ ì¸ì¦</title>
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/sub-page.css}">
        <link rel="stylesheet" th:href="@{/css/form.css}">
        <style>
            .email-verification-box {
                text-align: center;
                padding: 40px 20px;
            }
            .email-icon {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 80px;
                height: 80px;
                background: linear-gradient(135deg, #e7f1ff 0%, #cce5ff 100%);
                border-radius: 50%;
                font-size: 2.5rem;
                margin-bottom: 24px;
            }
            .email-address {
                display: inline-block;
                padding: 12px 24px;
                background-color: #f8f9fa;
                border-radius: 8px;
                font-size: 1.125rem;
                font-weight: 600;
                color: #0d6efd;
                margin: 16px 0 24px;
            }
            .verification-guide {
                background-color: #fff3cd;
                border: 1px solid #ffecb5;
                border-radius: 8px;
                padding: 20px;
                margin: 24px 0;
                text-align: left;
            }
            .verification-guide-title {
                font-weight: 600;
                color: #664d03;
                margin-bottom: 12px;
            }
            .verification-guide ul {
                margin: 0;
                padding-left: 20px;
                color: #664d03;
            }
            .verification-guide li {
                margin-bottom: 8px;
                line-height: 1.6;
            }
            .resend-section {
                margin-top: 32px;
                padding-top: 24px;
                border-top: 1px solid #e9ecef;
            }
            .resend-text {
                font-size: 0.9375rem;
                color: #6c757d;
                margin-bottom: 12px;
            }
            .timer {
                font-size: 1.5rem;
                font-weight: 700;
                color: #dc3545;
                margin-bottom: 16px;
            }
            .timer.expired {
                color: #6c757d;
            }
        </style>
    </th:block>
</head>
<body>
<main layout:fragment="content">
    <!-- í˜ì´ì§€ ë°°ë„ˆ -->
    <th:block th:replace="~{fragments/page-banner :: page-banner('íšŒì›ê°€ì…', 'ë§ˆì´ë°ì´í„° í…ŒìŠ¤íŠ¸ë² ë“œ íšŒì›ì´ ë˜ì–´ë³´ì„¸ìš”.')}"></th:block>

    <!-- ë¸Œë ˆë“œí¬ëŸ¼ -->
    <th:block th:replace="~{fragments/breadcrumb :: breadcrumb(${breadcrumbItems})}"></th:block>

    <!-- íšŒì›ê°€ì… í¼ -->
    <div class="form-page form-page-wide">
        <div class="form-container">
            <!-- ë‹¨ê³„ í‘œì‹œ -->
            <div class="step-indicator">
                <div class="step-indicator-item completed">
                    <span class="step-number-indicator">âœ“</span>
                    <span class="step-indicator-label">ì•½ê´€ë™ì˜</span>
                </div>
                <div class="step-indicator-item completed">
                    <span class="step-number-indicator">âœ“</span>
                    <span class="step-indicator-label">íœ´ëŒ€í° ì¸ì¦</span>
                </div>
                <div class="step-indicator-item completed">
                    <span class="step-number-indicator">âœ“</span>
                    <span class="step-indicator-label">íšŒì›ì •ë³´ ì…ë ¥</span>
                </div>
                <div class="step-indicator-item active">
                    <span class="step-number-indicator">4</span>
                    <span class="step-indicator-label">ì´ë©”ì¼ ì¸ì¦</span>
                </div>
            </div>

            <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
            <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
            
            <!-- ì„±ê³µ ë©”ì‹œì§€ -->
            <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>

            <!-- ì´ë©”ì¼ ì¸ì¦ ì•ˆë‚´ -->
            <div class="email-verification-box">
                <div class="email-icon">âœ‰ï¸</div>
                <h2 class="form-title">ì¸ì¦ ë©”ì¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤</h2>
                <p class="form-description">
                    ì•„ë˜ ì´ë©”ì¼ ì£¼ì†Œë¡œ ì¸ì¦ ë§í¬ë¥¼ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.<br>
                    ë©”ì¼í•¨ì„ í™•ì¸í•˜ì‹œê³  ì¸ì¦ ë§í¬ë¥¼ í´ë¦­í•´ì£¼ì„¸ìš”.
                </p>
                <div class="email-address" th:text="${email}">example@email.com</div>
                
                <!-- ì¸ì¦ ë§í¬ ë§Œë£Œ ì‹œê°„ ì•ˆë‚´ -->
                <div class="timer" id="timer">24:00:00</div>
                <p class="text-muted" style="font-size: 0.875rem;">ì¸ì¦ ë§í¬ ìœ íš¨ ì‹œê°„</p>
            </div>

            <!-- ì•ˆë‚´ ì‚¬í•­ -->
            <div class="verification-guide">
                <p class="verification-guide-title">ğŸ“Œ ì´ë©”ì¼ì´ ì˜¤ì§€ ì•Šë‚˜ìš”?</p>
                <ul>
                    <li>ìŠ¤íŒ¸ ë©”ì¼í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</li>
                    <li>ì´ë©”ì¼ ì£¼ì†Œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</li>
                    <li>ëª‡ ë¶„ í›„ì—ë„ ë©”ì¼ì´ ì˜¤ì§€ ì•Šìœ¼ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¬ë°œì†¡í•˜ì„¸ìš”.</li>
                    <li>ì¸ì¦ ë§í¬ëŠ” <strong>24ì‹œê°„</strong> ë™ì•ˆ ìœ íš¨í•©ë‹ˆë‹¤.</li>
                </ul>
            </div>

            <!-- ì¬ë°œì†¡ ì„¹ì…˜ -->
            <div class="resend-section">
                <p class="resend-text">ë©”ì¼ì„ ë°›ì§€ ëª»í•˜ì…¨ë‚˜ìš”?</p>
                <form th:action="@{/member/signup/resend-email}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-outline" id="resendBtn">
                        ì¸ì¦ ë©”ì¼ ì¬ë°œì†¡
                    </button>
                </form>
            </div>

            <!-- ì´ì „ ë²„íŠ¼ -->
            <div class="form-actions" style="margin-top: 32px;">
                <a th:href="@{/member/signup/step3}" class="btn btn-secondary">ì´ì „ ë‹¨ê³„ë¡œ</a>
            </div>
        </div>
    </div>
</main>

<th:block layout:fragment="script">
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // ë§Œë£Œ ì‹œê°„ (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ê±°ë‚˜ ê¸°ë³¸ê°’ 24ì‹œê°„)
            const expiresAt = /*[[${expiresAt}]]*/ null;
            
            if (expiresAt) {
                startTimer(new Date(expiresAt));
            } else {
                // í…ŒìŠ¤íŠ¸ìš©: 24ì‹œê°„ í›„
                const expireTime = new Date();
                expireTime.setHours(expireTime.getHours() + 24);
                startTimer(expireTime);
            }
            
            function startTimer(expireTime) {
                const timerEl = document.getElementById('timer');
                
                function updateTimer() {
                    const now = new Date();
                    const diff = expireTime - now;
                    
                    if (diff <= 0) {
                        timerEl.textContent = 'ë§Œë£Œë¨';
                        timerEl.classList.add('expired');
                        return;
                    }
                    
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    timerEl.textContent = 
                        String(hours).padStart(2, '0') + ':' +
                        String(minutes).padStart(2, '0') + ':' +
                        String(seconds).padStart(2, '0');
                }
                
                updateTimer();
                setInterval(updateTimer, 1000);
            }
            
            // ì¬ë°œì†¡ ë²„íŠ¼ ì¿¨ë‹¤ìš´ (ë‚¨ìš© ë°©ì§€)
            const resendBtn = document.getElementById('resendBtn');
            let cooldown = 0;
            
            resendBtn.addEventListener('click', function(e) {
                if (cooldown > 0) {
                    e.preventDefault();
                    alert(cooldown + 'ì´ˆ í›„ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì¬ë°œì†¡ í›„ 60ì´ˆ ì¿¨ë‹¤ìš´
                cooldown = 60;
                resendBtn.disabled = true;
                
                const interval = setInterval(function() {
                    cooldown--;
                    resendBtn.textContent = 'ì¬ë°œì†¡ ëŒ€ê¸° (' + cooldown + 'ì´ˆ)';
                    
                    if (cooldown <= 0) {
                        clearInterval(interval);
                        resendBtn.disabled = false;
                        resendBtn.textContent = 'ì¸ì¦ ë©”ì¼ ì¬ë°œì†¡';
                    }
                }, 1000);
            });
        });
    </script>
</th:block>
</body>
</html>
